import os
import numpy
from PIL import Image
from StringIO import StringIO

def getWidth(size):
   widthtable = [(10240, 32),
                 (30720, 64),
                 (61440, 128),
                 (102400, 256),
                 (204800, 384),
                 (512000, 512),
                 (1024000, 768)]
   maxwidth = 1024
   for w in widthtable:
       if size<w[0]:
           return w[1]
   return maxwidth

# Convert malware to png image
def convert(malware):
   size = os.path.getsize(malware)
   width = getWidth(size)
   a = numpy.fromfile(malware, dtype=numpy.uint8, count=size-(size%width))
   g = numpy.reshape(a,(len(a)/width,width))
   im = Image.fromarray(g.astype(numpy.uint8))
   im = im.resize((224, 224), Image.ANTIALIAS)
   im_io = StringIO()
   im.save(im_io,'PNG')
   im_io.seek(0)
   return im_io.getvalue()
